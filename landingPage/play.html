<!DOCTYPE html>
<html lang="en">
<head>
  <title>FurQuest</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-analytics.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.19.1/firebase-database.js"></script>
  <link rel="stylesheet" href="homeStyles.css">
</head>
<body>

<canvas id="gameCanvas"  style="border:2px solid #FFFFFF;  position:fixed; z-index:-1; left: 450px">
</canvas>

<img id="town" src="../assets/town.png" alt="The town" style="display:none; z-index:-1">
<img id="town2" src="../assets/town2.png" alt="The town" style="display:none; z-index: -1">
</body>

<script>

var gameCanvas = document.getElementById("gameCanvas") 
gameCanvas.width = 1010
gameCanvas.height = 630
var ctx = gameCanvas.getContext("2d");
var img = document.getElementById("town");
var img2 = document.getElementById("town2");

var playerImg = new Image();
playerImg.src = "../assets/bear.png"
var playerX = 950
var playerY = 400

ctx.globalCompositeOperation='source-over';
ctx.drawImage(img, 5, 5)

playerImg.onload = function(e) {
   ctx.drawImage(e.target, 500, 400, 80, 80)
}

ctx.drawImage(playerImg, 30, 30, 0.2 ,2)
// x: 453, y: 0, top point , basically just subtract 453
function modifyScene(x, y){

  if(x > -.49 && x < -.40 && y > 0.015 && y < 0.177){
     console.log("entering coffee shop");
     ctx.drawImage(img2, 5, 5)
	 movePlayerCof(playerX, playerY)
  }
  else{
     //ctx.drawImage(img, 5, 5)

  }

}

var destX = 500
var destY = 500

let start = -1;
var playerSpeed = .01 // 10px/s
var isRight = true;
var isUp = true;
function render(time) {
  var timeS = time * 0.001;  // seconds
  if (start == -1){
    start = time
  }
  const elapsed = time - start;
  console.log("elapsed:" + elapsed)
  
  //ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
  
  var t1x =(playerSpeed * (destX - playerX));
  var t1y = (playerSpeed * (destY - playerY));
  ctx.drawImage(img, 5, 5)
  ctx.drawImage(playerImg, playerX + t1x - 453, playerY + t1y, 80, 80);
  playerX = playerX + t1x 
  playerY = playerY + t1y
  console.log(playerX)
  console.log(playerY)
  
  if (elapsed < 5000) { // Stop the animation after 2 seconds
    requestAnimationFrame(render);
  }
  
}

function movePlayer(x, y){
  start = -1
  console.log('beep')
  destX = x 
  destY = y
  ctx.drawImage(img, 5, 5)
  if(destX > playerX){
    isRight = true
  }else{
    isRight = false
  }
  if(destY > playerY){
    isUp = true
  }else{
    isUp =false 
  }
  requestAnimationFrame(render);
}

function movePlayerCof(x, y){
  console.log('beep')
  ctx.drawImage(img2, 5, 5)
  ctx.drawImage(playerImg, x - 453, y, 80, 80)
  playerX = x
  playerY = y
}

gameCanvas.addEventListener("mousedown", e => { 
  console.log("moving character")
  var x = e.clientX
  var y = e.clientY
  console.log("X: "+ e.clientX)
  console.log("Y: "+ e.clientY)
  var rectangle = e.target.getBoundingClientRect(); 
	
  var x = ((x - rectangle.left)-(gameCanvas.width/2))/(gameCanvas.width/2);
  var y = ((gameCanvas.height/2)-(y-rectangle.top))/(gameCanvas.height/2);
  console.log("x: "+ x)
  console.log("y: "+ y)
  
  modifyScene(x, y)
  movePlayer(e.clientX, e.clientY)
})

gameCanvas.addEventListener("mousemove", e => { 
  var x = e.clientX
  var y = e.clientY
  console.log("X: "+ e.clientX)
  console.log("Y: "+ e.clientY)
  var rectangle = e.target.getBoundingClientRect(); 
	
  var x = ((x - rectangle.left)-(gameCanvas.width/2))/(gameCanvas.width/2);
  var y = ((gameCanvas.height/2)-(y-rectangle.top))/(gameCanvas.height/2);
  console.log("x: "+ x)
  console.log("y: "+ y)
  
  modifyScene(x, y)
})

var firebaseConfig = {
    apiKey: "AIzaSyDGPX41BsvlB0a05akJiWTS_9yH_UZO744",
    authDomain: "furquest-1c939.firebaseapp.com",
    databaseURL: "https://furquest-1c939.firebaseio.com",
    projectId: "furquest-1c939",
    storageBucket: "furquest-1c939.appspot.com",
    messagingSenderId: "178770843812",
    appId: "1:178770843812:web:f8bf303167b573f41c6e31",
    measurementId: "G-D1DXBJLC06"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  firebase.analytics();
  const db = firebase.database().ref();
  
firebase.auth().onAuthStateChanged(firebaseUser => {
  if(firebaseUser){
    console.log(firebaseUser);

  }
  else{
    console.log("not logged in");
	alert("please log in")
  }
})

</script>
</html>